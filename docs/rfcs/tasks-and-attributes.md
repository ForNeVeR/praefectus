Tasks and Attributes
====================

_Task_ is the main piece of information used by Praefectus. Conceptually, the
only requirement for something being a task is that it has to have some
_definition of done_: it should be clear (to the one who manages the task at
least) what does it mean for the task to be _done_; which particular conditions
allow to consider the task as _closed_, i.e. not requiring any additional
actions.

Attributes
----------

In Praefectus, a _task_ is characterized by a set of attribute values. A _task
attribute_ is a metainformational entity that describes a piece of information
of which a _task_ may consist of.

Attribute itself has the following attributes:

- `namespace`: an identifier of entity that controls the attribute. For core
  attributes, `praefectus` is the name; for other attributes (including the ones
  introduced by third-party plugins and/or users themselves), it is recommended
  to follow [Java package naming convention][java-package-naming]:

  > Companies use their reversed Internet domain name to begin their package
  > namesâ€”for example, `com.example.mypackage` for a package named mypackage
  > created by a programmer at `example.com`.

  > Name collisions that occur within a single company need to be handled by
  > convention within that company, perhaps by including the region or the
  > project name after the company name (for example,
  > `com.example.region.mypackage`).

- `id`: an identifier of particular attribute. Attribute identifiers should be
  unique inside of a namespace; no tro attributes are to occupy the same
  `namespace`+`id` pair.

  For short, attributes may be referred by a pair of `namespace.id`; for
  example, `praefectus.id` means "an attribute in namespace `praefectus` named
  `id`".

- `type`: a data type of the attribute values. Currently, the following simple
  data types are supported by Praefectus:

  - `boolean`: a boolean value, either true of false.
  - `enum`: a value from a finite set of named entities, declared by the type.
    One particular example is `enum[A, B, None]`.
  - `string`: a (reasonably-unlimited) sequence of Unicode characters.
  - `integer`: a 32-bit signed integer value
  - `double`: a 64-bit floating-point value, called as `binary64` in the IEEE
    754-2008 standard.
  - `timestamp`: a 64-bit UTC timestamp (count of milliseconds since
    `1970-01-01T00:00:00.000Z`) with local time zone offset.
  - `task`: a reference to another (or the same) task, represented by task
    identifier. Could be checked automatically to determine health of the
    database.

  Also, there's a complex data type supported: `list<T>`, where `T` is any of
  the simple data types. List is a finite sequence of values of the
  corresponding type.

- `description`: an optional attribute description in text format.

All attributes of attribute, except for `description`, are required.

A Praefectus plugin, or user themselves, may register new attributes, and these
attributes will be available for the newly-created tasks.

Core Attributes
---------------

Basic task in Praefectus has the following attributes, of which only
`praefectus.id` is mandatory. These attributes are essential for the Praefectus
engine to function.

- `praefectus.id: string`: a task identifier. Should be unique across all of the
  Praefectus network; thus, nodes are recommended to add unique node identifier
  before task identifiers generated by them. For example, a node named `home`
  could generate simple incremental task identifiers prepending them with
  `home.`: `home.1`, `home.2` etc.
- `praefectus.title: string`: a short task title description or summary; will be
  shown in most of the default Praefectus views, so should be concise.
- `praefectus.created: timestamp`: date of task creation.
- `praefectus.updated: timestamp`: date of the last task update.
- `praefectus.status: enum[Open, InProgress, Done, Deleted]`: a task status.
  While `Open` and `InProgress` are self-explanatory, `Done` and `Deleted`

Additional Attributes
---------------------

There're additional task attributes defined by the Praefectus engine, which are
non-essential, but still were considered useful enough to be enabled by default.

- `praefectus.depends-on: list<task>`: a list of tasks this one depends on.

Calculated Attributes
---------------------

Not all of the attributes are stored in the Praefectus data storage. Some are
calculated on fly, because they depend on the calculation time.

- `praefectus.actually-depends-on: list<task>`: a set of unresolved tasks (i.e.
  not `Done` or `Deleted`) this one depends on.

Attribute Metadata Persistence
------------------------------

Praefectus data storage is a living system: new attributes may become added,
older ones may become retracted. Sometimes, an attribute data type may be
changed, or a new attribute with the same name may be created, rendering the old
data incompatible with the new attribute data type.

Praefectus will ignore values of inconsistent data types when performing any
automated calculations on the attributes, and will issue a diagnostic warning if
any data is found in the database in any of the following inconsistent states:

- a value of an non-existing (or deleted) attribute
- a value of attribute doesn't correspond to the data type of that attribute

There's only one possible data type change that doesn't affect the attribute
value compatibility: it is change of enum values (either extending the enum
value set with a new value, or deleting an enum member that wasn't used
anywhere); any other data type changes will render all the current values of
that attribute incompatible.

Attribute owners are suggested to be very careful when designing of changing the
attribute data types to not render all the data unusable.

Notes on Distributed Data
-------------------------

A task attribute list describes a Praefectus node, so the attributes are subject
for data storage sharing and task migration. An end-user Praefectus node should
know of the current attribute sets of all the nodes it is connected to, which
should allow to make informed decisions when merging data from various
attributes.

[java-package-naming]: https://docs.oracle.com/javase/tutorial/java/package/namingpkgs.html
